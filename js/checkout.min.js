function DisplayUserData() {
  const e = JSON.parse(localStorage.getItem("usersDetails")) || [],
    t = e.find((e) => "true" === e.loggedIn);
  if (t) {
    const e = [
      { id: "firstName", value: t.firstName },
      { id: "lastName", value: t.lastName },
      { id: "addressLine1", value: t.addressLine1 },
      { id: "addressLine2", value: t.addressLine2 },
      { id: "eircode", value: t.eirCode },
      { id: "email", value: t.email },
    ];
    e.forEach(({ id: e, value: t }) => {
      document.getElementById(e).setAttribute("value", t);
    });
  }
}
async function CheckOutCart() {
  event.preventDefault();
  document.getElementById("errorAlert");
  const e = document.getElementById("container");
  ClearErrorAlerts();
  const t = document.getElementById("nameOnCard").value.trim(),
    r = document.getElementById("cardNumber").value,
    a = parseInt(document.getElementById("cvc").value);
  let n = {};
  try {
    const t = await fetch("../source/paymentCardDetails.json");
    n = await t.json();
  } catch (t) {
    return void ShowErrorAlert(
      e,
      "Failed to process payment details! Please try again later."
    );
  }
  t === n.nameOnCard && r === n.cardNumber && a === n.cvc
    ? (ShowSuccessAlert(e),
      setTimeout(() => {
        let e = localStorage.setItem("numberOfItemsInCart", 0);
        const t = document.getElementById("cartCount");
        (t.textContent = e),
          localStorage.setItem("currentCartItems", JSON.stringify([])),
          (window.location = "../index.html");
      }, 3e3))
    : ShowErrorAlert(e, "Invalid Credentials!");
}
function ClearErrorAlerts() {
  const e = document.getElementById("errorAlert");
  e && e.remove();
}
function ShowErrorAlert(e, t) {
  const r = document.createElement("div");
  (r.id = "errorAlert"),
    r.setAttribute("class", "alert alert-danger mt-2"),
    r.setAttribute("role", "alert"),
    (r.textContent = t),
    e.append(r);
}
function ShowSuccessAlert(e) {
  const t = document.createElement("div");
  t.setAttribute("class", "alert alert-success mt-2"),
    t.setAttribute("role", "alert"),
    (t.textContent =
      "Payment successful! You will be redirected to home page shortly."),
    e.appendChild(t);
}
document.addEventListener("DOMContentLoaded", async () => {
  DisplayUserData(),
    document.getElementById("checkOutForm").addEventListener(
      "submit",
      async () => {
        await CheckOutCart();
      },
      !1
    );
});
